---
title: "Literature review"
output: html_document
---

```{r,echo=FALSE, message=FALSE, results='hide', warning=FALSE}
# Loading libraries
library(ggplot2)
library(splitstackshape)
library(igraph)
library(knitr)

# Set ggplot theme
theme_set(theme_minimal(15))
```


```{r, echo=FALSE, warning=FALSE, results='hide'}
# Loading and preparing data

# Call cleaning2.R to process the data in the input folder and 
# save processed files to output folder
source("cleaning2.R", chdir = T)

# Helper function to remove leading and trailing whitespace
trim <- function (x) gsub("^\\s+|\\s+$", "", x)

# Fixing variable types
literature$AuthorFullName <- as.character(literature$AuthorFullName)
literatureByAuthor$AuthorFullName <- as.character(literatureByAuthor$AuthorFullName)
literatureByKeywords$AuthorFullName <- as.character(literatureByKeywords$AuthorFullName)
literatureByCategory$AuthorFullName <- as.character(literatureByCategory$AuthorFullName)

literature$Abstract <- as.character(literature$Abstract)
literature$DocumentTitle <- as.character(literature$DocumentTitle)

literature$YearPublished <- as.numeric(as.character(literature$YearPublished))

literature$CitedReferences <- as.character(literature$CitedReferences)

literature$TimesCited <- as.numeric(literature$TimesCited)
literatureByAuthor$TimesCited <- as.numeric(literatureByAuthor$TimesCited)
literatureByKeywords$TimesCited <- as.numeric(literatureByKeywords$TimesCited)
literatureByCategory$TimesCited <- as.numeric(literatureByCategory$TimesCited)

literature$AuthorKeywords <- as.character(literature$AuthorKeywords)

literatureByKeywords$AuthorKeywords <- as.character(literatureByKeywords$AuthorKeywords)
```
This report provides an analysis on the records downloaded from [Web of Science](http://webofscience.com). The analysis identifies the important authors, journals, and keywords in the dataset based on the number of occurences and citation counts. A citation network of the provided records is created and used to identify the important papers according to their in-degree, total citation count and PageRank scores. The analysis finds also often-cited references that were not included in the original dataset downloaded from the Web of Science.

See the following article for further details: [Knutas, A., Hajikhani, A., Salminen, J., Ikonen, J., Porras, J., 2015. Cloud-Based Bibliometric Analysis Service for Systematic Mapping Studies. CompSysTech 2015](http://www.codecamp.fi/lib/exe/fetch.php/wiki/nails-compsystech2015-preprint.pdf). Please cite our research paper on bibliometrics if you publish the analysis results. Use is otherwise free. 

The analysed dataset consist of `r nrow(literature)` records with `r ncol(literature)` variables. More information about the variables can be found at [Web of Science](https://images.webofknowledge.com/WOK46/help/WOS/h_fullrec.html). 

## Publication years 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
qplot(data = literature, YearPublished, fill = I("darkgreen"), binwidht = 1) + 
    ggtitle("Year published") + 
    xlab("Year") + 
    ylab("Article count")
```


## Important authors
Sorted by the number of articles published and by the total number of citations.
```{r,echo=FALSE, fig.height=7}
# Calculating total number of citations for each author
citationSums <- aggregate(literatureByAuthor$TimesCited, 
    by = list(AuthorFullName = toupper(literatureByAuthor$AuthorFullName)), 
    FUN = sum)

# Fixing column names
names(citationSums) <- c("AuthorFullName", "TotalTimesCited")
# Crating new data frame to plot citations by author

# Extract author names 
authorNames <- unlist(strsplit(literature$AuthorFullName, ";"))
# Remove apostrophes
authorNames <- gsub("'", "", authorNames)
# Count author name frequencies
authors <- table(authorNames)
# Transform to a data frame
authors <- as.data.frame(authors)
# Merge with data frame containing the total times citated by each author
authors <- merge(authors, citationSums, by.x = "authorNames", 
              by.y = "AuthorFullName" )
# Fix column name
names(authors)[1] <- "AuthorFullName" 
# Sort the table by total times sited, decreasing order
authors <- authors[with (authors, order(-TotalTimesCited)), ]
# Extract the names of top 25 most cited authors
top25 <- head(authors$AuthorFullName, 25)
# Merge with the rest of the data. This data frame can have the same author name
# multiple times
authorsdf <- merge(authors, literatureByAuthor, by = "AuthorFullName")
# Extract top 25 most cited authors. This data frame has each author name only once.
top25Authors <- head(authors, 25)
# Top 25 authors again. Each article on a separate row.
top25Authorsdf <- authorsdf[authorsdf$AuthorFullName %in% top25, ]
top25Authorsdf <- transform(top25Authorsdf, 
                            AuthorFullName = reorder(AuthorFullName, TotalTimesCited))

# Sort authors by number of articles, extract top 25, 
# and reorder factors for plotting
authors <- authors[with (authors, order(-Freq)), ]
authorsPop <- head(authors, 25)
authorsPop <- transform(authorsPop, AuthorFullName = reorder(AuthorFullName, Freq))

ggplot(authorsPop, aes(AuthorFullName, Freq)) +
    geom_bar(stat = "identity", fill = "blue") + 
    coord_flip() +
    ggtitle("Top 25 most productive authors") + 
    xlab("Author") + 
    ylab("Number of articles")
```

```{r,echo=FALSE}
ggplot(top25Authorsdf, aes(AuthorFullName, TimesCited)) + 
    geom_boxplot(color = "blue") +
    coord_flip() +
    ggtitle("Citations of top 25\nmost cited authors") + 
    xlab("Author") + ylab("Times cited")
```

## Important publications
Sorted by number of published articles in the dataset and by the total number of citations.
```{r,echo=FALSE, fig.width=10, fig.height=7}
# Calculating total citations for each publication.
# Functionality same as for the authors, see above.

citationSums <- aggregate(literature$TimesCited, 
    by = list(PublicationName= literature$PublicationName), 
    FUN = sum)
names(citationSums) <- c("PublicationName", "PublicationTotalCitations")
citationSums <- citationSums[with (citationSums, order(-PublicationTotalCitations)), ]
top25 <- head(citationSums[,c("PublicationName", "PublicationTotalCitations")], 25)

publications <- sort(table(literature$PublicationName), decreasing = T)
publications <- as.data.frame(publications)
publications$Publication <- row.names(publications)
names(publications) <- c("Count", "Publication")
publications$Publication <- strtrim(publications$Publication, 50)
publications <- transform(publications, Publication = reorder(Publication, Count))

literature <- merge(literature, citationSums, 
                    by = "PublicationName" )

top25Lit <- literature[literature$PublicationName %in% top25$PublicationName, ]
top25Lit$PublicationName <- strtrim(top25Lit$PublicationName, 50)
top25Lit <- transform(top25Lit,  
            PublicationName = reorder(PublicationName, PublicationTotalCitations))

ggplot(head(publications, 25), aes(Publication, Count)) + 
    geom_bar(stat = "identity", fill = "orange") + 
    coord_flip() + 
    theme(legend.position = "none") +
    ggtitle("Most popular publications") + 
    xlab("Publication") + 
    ylab("Article count")
```


```{r,echo=FALSE, fig.width=10, fig.height=7}
ggplot(top25Lit, 
       aes(PublicationName, TimesCited)) + 
    geom_boxplot(color = "orange") + 
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Top 25\nmost cited publications") + 
    xlab("Publication") + ylab("Times cited")
```


## Important keywords
Sorted by the number of articles where the keyword is mentioned and by the total number of citations for the keyword.
```{r, echo=FALSE, fig.height=7, fig.width=8}
# Calculating total citations for each keyword
# Functionality same as for the authors, see above.

keywordCitationSum <- aggregate(literatureByKeywords$TimesCited, 
                                by = list(AuthorKeywords = 
                            literatureByKeywords$AuthorKeywords), FUN = sum)
names(keywordCitationSum) <- c("AuthorKeywords", "TotalTimesCited")

keywords <- unlist(strsplit(literature$AuthorKeywords, ";"))
keywords <- trim(keywords)
keywords <- table(keywords)
keywords <- as.data.frame(keywords)
names(keywords) <- c("AuthorKeywords", "Freq")

keywords <- merge(keywords, keywordCitationSum, by = "AuthorKeywords")

keywords <- keywords[with (keywords, order(-TotalTimesCited)), ]
top25 <- head(keywords$AuthorKeywords, 25)
keywordsdf <- merge(keywords, literatureByKeywords, by = "AuthorKeywords")
top25keywords <- head(keywords, 25)
top25keywordsdf <- keywordsdf[keywordsdf$AuthorKeywords %in% top25, ]

keywords <- keywords[with (keywords, order(-Freq)), ]
keywordsPop <- head(keywords, 25)
keywordsPop <- transform(keywordsPop, AuthorKeywords = 
                             reorder(AuthorKeywords, Freq))

top25keywordsdf <- transform(top25keywordsdf, 
                             AuthorKeywords = reorder(AuthorKeywords, TotalTimesCited))

ggplot(keywordsPop, aes(AuthorKeywords, Freq)) +
    geom_bar(stat = "identity", fill = "purple") + 
    coord_flip() +
    ggtitle("Top 25 most popular keywords") + 
    xlab("Keyword") + 
    ylab("Number of occurences")
```

```{r,echo=FALSE}
ggplot(top25keywordsdf, aes(AuthorKeywords, TimesCited)) + 
    geom_boxplot(color = "purple") +
    coord_flip()  +
    ggtitle("Citations of top 25 most cited keywords") + 
    xlab("Keyword") + ylab("Times cited")
```

## The most important papers
The most important papers and other sources are identified below using three importance measures: 1) in-degree in the citation network, 2) citation count provided by Web of Science (only for papers included in the dataset), and 3) PageRank score in the citation network. The top 25 highest scoring papers are identified using these measures separately. The results are then combined and duplicates are removed. Results are sorted by in-degree, and ties are first broken by citation count and then by the PageRank.

When a [Digital Object Identifier (DOI)](http://www.doi.org/) is available, the full paper can be found using [Resolve DOI](https://dx.doi.org/) website. 

```{r,echo=FALSE}
# Create igraph
citationGraph <- graph.data.frame(citationEdges, vertices = citationNodes)
# Calculate PageRanks
citationNodes$PageRank <- page.rank(citationGraph)$vector
# Calculate in-degrees
citationNodes$InDegree <- degree(citationGraph, mode = "in")

# Extract the articles included in the data set and articles not included
# in the dataset
citationsLit <- citationNodes[citationNodes$Origin == "literature", ]
citationsLit <- merge(citationsLit, literature[, c(2, 11, 23, 33, 62)], 
                       by.x = "FullReference", by.y = "ReferenceString")
citationsLit$Article <- paste(toupper(citationsLit$DocumentTitle), " | ",
                              citationsLit$FullReference, " | ", 
                                      citationsLit$Abstract)
citationsRef <- citationNodes[citationNodes$Origin == "reference", ]

# Trim FullReference to 100 characters
citationsLit$FullReference <- strtrim(citationsLit$FullReference, 100)
citationsRef$FullReference <- strtrim(citationsRef$FullReference, 100)
```

### Included in the dataset
These papers were included in the `r nrow(literature)` records downloaded from the Web of Science.
```{r, echo=FALSE}
citationsLit <- citationsLit[with (citationsLit, order(-TimesCited)), ]
topLit <- head(citationsLit, 25)
citationsLit <- citationsLit[with (citationsLit, order(-InDegree)), ]
topLit <- rbind(topLit, head(citationsLit, 25))
citationsLit <- citationsLit[with (citationsLit, order(-PageRank)), ]
topLit <- rbind(topLit, head(citationsLit, 25))
topLit <- topLit[!duplicated(topLit[, "FullReference"]), ]
topLit <- topLit[with (topLit, order(-InDegree, -TimesCited, -PageRank)), ]
kable(topLit[, c("Article", "InDegree", "TimesCited","PageRank")])
```

### Not included in the dataset
These papers and other references were not among the `r nrow(literature)` records downloaded from the Web of Science.
```{r, echo=FALSE}
citationsRef <- citationsRef[with (citationsRef, order(-InDegree)), ]
topRef <- head(citationsRef, 25)
citationsRef <- citationsRef[with (citationsRef, order(-PageRank)), ]
topRef <- rbind(topRef, head(citationsRef, 25))
topRef <- topRef[!duplicated(topRef[, "FullReference"]), ]
topRef <- topRef[with (topRef, order(-InDegree, -PageRank)), ]
kable(topRef[, c("FullReference", "InDegree", "PageRank")])
```

